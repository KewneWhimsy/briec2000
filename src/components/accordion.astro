---
// src/components/accordion.astro
// Composant accordéon réutilisable avec bonhommes et police --font-start

import OptimizeImage from './optimize_image.astro';

export interface Props {
  title: string;
  creature: 'ghost' | 'bule' | 'loup';
  id: string; // ID unique pour chaque accordéon
  className?: string;
}

const { 
  title, 
  creature, 
  id,
  className = ""
} = Astro.props;

// Mapping des créatures vers leurs images
const creatureImages = {
  ghost: "/src/assets/ghost500x500.png",
  bule: "/src/assets/bule500x500.png",
  loup: "/src/assets/loup500x500.png"
};

const creatureSrc = creatureImages[creature];
---

<div class={`accordion-item border border-[var(--color-border)] rounded-lg overflow-hidden bg-[var(--bg-color)] shadow-sm ${className}`}>
  <input 
    type="checkbox" 
    id={`accordion-${id}`}
    class="sr-only"
  />
  <label 
    for={`accordion-${id}`}
    class="block select-none w-full px-4 py-4 bg-[color:rgba(var(--color-primary-rgb),0.05)] hover:bg-[color:rgba(var(--color-primary-rgb),0.08)] transition-colors duration-200 cursor-pointer sm:px-6"
  >
    <div class="flex items-center justify-between gap-3">
      <span class="accordion-title flex-1 min-w-0">
        {title}
      </span>
      <div class="accordion-toggle flex-shrink-0 w-16 h-16 transition-transform duration-300">
        <OptimizeImage
          src={creatureSrc}
          alt="Toggle"
          class="w-full h-full object-contain theme-filtered"
          widths={[48, 64, 128]}
          sizes="(max-width: 640px) 48px, 64px"
        />
      </div>
    </div>
  </label>
  <div class="accordion-content max-h-0 overflow-hidden transition-all duration-300">
    <div class="px-4 pt-6 pb-2 bg-[var(--bg-color)] border-t border-[var(--color-border)] sm:px-6">
      <slot />
    </div>
  </div>
</div>

<style>
  /* Styles pour l'accordéon */
  .accordion-title {
    font-family: var(--font-start);
    font-weight: bold;
    color: var(--color-primary);
    font-size: 1rem;
    line-height: 1.3;
    word-break: break-word;
  }
  
  /* Taille plus grande sur desktop */
  @media (min-width: 640px) {
    .accordion-title {
      font-size: 1.125rem;
    }
  }
  
  /* Anti-flou plus doux pour les rotations */
  .accordion-toggle {
    will-change: transform;
    transform: translateZ(0);
  }
  
  .accordion-item input[type="checkbox"]:checked + label .accordion-toggle {
    transform: rotateY(180deg) translateZ(0);
  }
  
  .accordion-item input[type="checkbox"]:checked ~ .accordion-content {
    max-height: 2000px;
    padding-bottom: 1rem;
  }
  
  /* Support pour prefers-reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    .accordion-toggle {
      transition: none;
    }
    
    .accordion-content {
      transition: none;
    }
    
    .accordion-item input[type="checkbox"]:checked + label .accordion-toggle {
      transform: none;
    }
  }
</style>