---
// src/components/theme_switcher.astro
// Un composant simple pour basculer entre des thèmes, incluant des options accessibles améliorées

// Définir les thèmes disponibles avec leurs couleurs caractéristiques
const themes = [
  // Thèmes standards clairs
  {
    id: "nature",
    name: "Nature",
    type: "light",
    bgColor: "#eef5ee",
    primaryColor: "#2e6b4a",
    secondaryColor: "#3e805c",
  },
  {
    id: "lavande",
    name: "Lavande",
    type: "light",
    bgColor: "#f5f0fa",
    primaryColor: "#7c5295",
    secondaryColor: "#583869",
  },

  // Thèmes standards sombres
  {
    id: "midnight",
    name: "Minuit",
    type: "dark",
    bgColor: "#1f2937",
    primaryColor: "#6889c2",
    secondaryColor: "#415a89",
  },
  {
    id: "forest",
    name: "Forêt",
    type: "dark",
    bgColor: "#1a2721",
    primaryColor: "#8fb996",
    secondaryColor: "#4d7a5a",
  },

  // Thèmes accessibles
  {
    id: "beige-emeraude",
    name: "Beige & Émeraude",
    type: "light",
    bgColor: "#f5f5dc",
    primaryColor: "#065f46",
    secondaryColor: "#047857",
    isAccessible: true,
  },
  {
    id: "vanille-violet",
    name: "Vanille & Violet",
    type: "light",
    bgColor: "#fff8e1",
    primaryColor: "#5b21b6",
    secondaryColor: "#4c1d95",
    isAccessible: true,
  },
  {
    id: "vert-rose",
    name: "Vert & Rose",
    type: "light",
    bgColor: "#d8f3dc",
    primaryColor: "#9d0191",
    secondaryColor: "#720e9e",
    isAccessible: true,
  },
  {
    id: "champagne-acier",
    name: "Champagne & Acier",
    type: "light",
    bgColor: "#fdf4ff",
    primaryColor: "#475569",
    secondaryColor: "#334155",
    isAccessible: true,
  },
  {
    id: "bleu-jaune",
    name: "Bleu & Jaune",
    type: "dark",
    bgColor: "#0e3165",
    primaryColor: "#ffdc00",
    secondaryColor: "#c4ad00",
    isAccessible: true,
  },
  {
    id: "gris-ambre",
    name: "Gris & Ambre",
    type: "dark",
    bgColor: "#27272a",
    primaryColor: "#fbbf24",
    secondaryColor: "#d97706",
    isAccessible: true,
  },
  {
    id: "ardoise-peche",
    name: "Ardoise & Pêche",
    type: "dark",
    bgColor: "#334155",
    primaryColor: "#fed7aa",
    secondaryColor: "#fb923c",
    isAccessible: true,
  },
  {
    id: "prune-menthe",
    name: "Prune & Menthe",
    type: "dark",
    bgColor: "#4a044e",
    primaryColor: "#a7f3d0",
    secondaryColor: "#6ee7b7",
    isAccessible: true,
  },
  {
    id: "aubergine-citron",
    name: "Aubergine & Citron",
    type: "dark",
    bgColor: "#3b0764",
    primaryColor: "#d9f99d",
    secondaryColor: "#94c063",
    isAccessible: true,
  },
  {
    id: "gris-citron",
    name: "Gris & Citron",
    type: "dark",
    bgColor: "#1f2937",
    primaryColor: "#ecfccb",
    secondaryColor: "#bef264",
    isAccessible: true,
  }, 

  {
    id: "olive-fuchsia",
    name: "Olive & Fuchsia",
    type: "dark",
    bgColor: "#3f4f3a",
    primaryColor: "#f472b6",
    secondaryColor: "#ec4899",
    isAccessible: true,
  },
  {
    id: "amethyste-or",
    name: "Améthyste & Or",
    type: "dark",
    bgColor: "#6b21a8",
    primaryColor: "#facc15",
    secondaryColor: "#eab308",
    isAccessible: true,
  },
// Thèmes clairs accessibles (avec couleurs de texte distinctives)
{
  id: "coquille-cardinal",
  name: "Coquille & Cardinal",
  type: "light",
  bgColor: "#eae2d6",
  primaryColor: "#8c1c13",
  secondaryColor: "#70160f",
  isAccessible: true,
},
{
  id: "abricot-marine",
  name: "Abricot & Marine",
  type: "light",
  bgColor: "#ffdfbf",
  primaryColor: "#003559",
  secondaryColor: "#002a45",
  isAccessible: true,
},
{
  id: "aigue-cerise",
  name: "Aigue & Cerise",
  type: "light",
  bgColor: "#d9f1e3",
  primaryColor: "#ad2e24",
  secondaryColor: "#8e251c",
  isAccessible: true,
},

// Thèmes sombres accessibles (avec couleurs de texte distinctives)
{
  id: "terre-orange",
  name: "Terre & Orange", 
  type: "dark",
  bgColor: "#453028",
  primaryColor: "#ff8c42",
  secondaryColor: "#e67d39",
  isAccessible: true,
},
{
  id: "marron-chartreuse",
  name: "Marron & Chartreuse",
  type: "dark",
  bgColor: "#583c2e",
  primaryColor: "#c5e063",
  secondaryColor: "#a2c836",
  isAccessible: true,
},
];
---

<div class="theme-switcher">
  {
    themes.map((theme) => (
      <button
        class="theme-btn"
        data-theme={theme.id}
        title={theme.isAccessible ? `${theme.name} (accessible)` : theme.name}
        aria-label={
          theme.isAccessible
            ? `Thème accessible ${theme.name}`
            : `Thème ${theme.name}`
        }
        style={`background-color: ${theme.bgColor}; border-color: ${theme.primaryColor};`}
      >
        <span
          class="theme-accent"
          style={`background-color: ${theme.primaryColor};`}
        />
        {theme.isAccessible && <span class="a11y-indicator select-none">A+</span>}
      </button>
    ))
  }
</div>

<style is:global>
  /* Thème Nature (clair) */
  html[data-theme="nature"] {
    --color-primary: #2e6b4a;
    --color-secondary: #3e805c;
    --color-accent: #e63946;
    --bg-color: #eef5ee;
    --text-color: #2a3b2d;
    --color-border: #d7e6db;
    --color-primary-rgb: 46, 107, 74;
  }

  /* Thème Lavande (clair) */
  html[data-theme="lavande"] {
    --color-primary: #7c5295;
    --color-secondary: #9a6db9;
    --color-accent: #f7ca44;
    --bg-color: #f5f0fa;
    --text-color: #2d2235;
    --color-border: #e5d8f0;
    --color-primary-rgb: 124, 82, 149;
  }

  /* Thème Minuit (sombre) */
  html[data-theme="midnight"] {
    --color-primary: #6889c2;
    --color-secondary: #415a89;
    --color-accent: #f7a046;
    --bg-color: #1f2937;
    --text-color: #e2e8f0;
    --color-border: #374151;
    --color-primary-rgb: 104, 137, 194;
  }

  /* Thème Forêt (sombre) */
  html[data-theme="forest"] {
    --color-primary: #8fb996;
    --color-secondary: #4d7a5a;
    --color-accent: #e9b44c;
    --bg-color: #1a2721;
    --text-color: #e2e8d5;
    --color-border: #2d433a;
    --color-primary-rgb: 143, 185, 150;
  }
  /* Thème Beige & Émeraude (accessible, clair) */
  html[data-theme="beige-emeraude"] {
    --color-primary: #065f46;
    --color-secondary: #047857;
    --color-accent: #f59e0b;
    --bg-color: #f5f5dc;
    --text-color: #1a1a1a;
    --color-border: #065f46;
    --color-primary-rgb: 6, 95, 70;
  }
  /* Thème Vanille & Violet (accessible, clair) */
  html[data-theme="vanille-violet"] {
    --color-primary: #5b21b6;
    --color-secondary: #4c1d95;
    --color-accent: #f97316;
    --bg-color: #fff8e1;
    --text-color: #1e1b4b;
    --color-border: #5b21b6;
    --color-primary-rgb: 91, 33, 182;
  }
  /* Thème Vert & Rose (accessible, clair) */
  html[data-theme="vert-rose"] {
    --color-primary: #9d0191;
    --color-secondary: #720e9e;
    --color-accent: #4cc9f0;
    --bg-color: #d8f3dc;
    --text-color: #2d0030;
    --color-border: #720e9e;
    --color-primary-rgb: 157, 1, 145;
  }
  /* Thème Champagne & Acier (accessible, clair) */
  html[data-theme="champagne-acier"] {
    --color-primary: #475569;
    --color-secondary: #334155;
    --color-accent: #f59e0b;
    --bg-color: #fdf4ff;
    --text-color: #0f172a;
    --color-border: #475569;
    --color-primary-rgb: 71, 85, 105;
  }
  /* Thème Bleu & Jaune (accessible, sombre) */
  html[data-theme="bleu-jaune"] {
    --color-primary: #ffdc00;
    --color-secondary: #dbbe02;
    --color-accent: #00ff00;
    --bg-color: #0e3165;
    --text-color: #ffffff;
    --color-border: #ffd60a;
    --color-primary-rgb: 255, 220, 0;
  }
  /* Thème Gris & Ambre (accessible, sombre) */
  html[data-theme="gris-ambre"] {
    --color-primary: #fbbf24;
    --color-secondary: #d97706;
    --color-accent: #a5f3fc;
    --bg-color: #27272a;
    --text-color: #f8fafc;
    --color-border: #fbbf24;
    --color-primary-rgb: 251, 191, 36;
  }
  /* Thème Ardoise & Pêche (accessible, sombre) */
  html[data-theme="ardoise-peche"] {
    --color-primary: #fed7aa;
    --color-secondary: #e88636;
    --color-accent: #fdba74;
    --bg-color: #334155;
    --text-color: #f8fafc;
    --color-border: #fed7aa;
    --color-primary-rgb: 254, 215, 170;
  }

  /* Thème Prune & Menthe (accessible, sombre) */
  html[data-theme="prune-menthe"] {
    --color-primary: #9ee6c4;
    --color-secondary: #5fcba0;
    --color-accent: #fde047;
    --bg-color: #4a044e;
    --text-color: #fdf2ff;
    --color-border: #a7f3d0;
    --color-primary-rgb: 167, 243, 208;
  }
  /* Thème Aubergine & Citron (accessible, sombre) */
  html[data-theme="aubergine-citron"] {
    --color-primary: #d9f99d;
    --color-secondary: #94c063;
    --color-accent: #fef08a;
    --bg-color: #3b0764;
    --text-color: #f5f5f5;
    --color-border: #d9f99d;
    --color-primary-rgb: 217, 249, 157;
  }
  /* Thème Gris & Citron (accessible, sombre) */
  html[data-theme="gris-citron"] {
    --color-primary: #ecfccb;
    --color-secondary: #a6d455;
    --color-accent: #fef08a;
    --bg-color: #1f2937;
    --text-color: #f9fafb;
    --color-border: #ecfccb;
    --color-primary-rgb: 236, 252, 203;
  }

  /* Thème Olive & Fuchsia (accessible, sombre) */
  html[data-theme="olive-fuchsia"] {
    --color-primary: #f472b6;
    --color-secondary: #ec4899;
    --color-accent: #fbcfe8;
    --bg-color: #3f4f3a;
    --text-color: #f0f9f0;
    --color-border: #f472b6;
    --color-primary-rgb: 244, 114, 182;
  }
  /* Thème Améthyste & Or (accessible, sombre) */
  html[data-theme="amethyste-or"] {
    --color-primary: #facc15;
    --color-secondary: #eab308;
    --color-accent: #a7f3d0;
    --bg-color: #6b21a8;
    --text-color: #f5f3ff;
    --color-border: #facc15;
    --color-primary-rgb: 250, 204, 21;
  }
/* Thème Coquille & Cardinal (accessible, clair) */
html[data-theme="coquille-cardinal"] {
  --color-primary: #8c1c13;
  --color-secondary: #70160f;
  --color-accent: #46b1c9;
  --bg-color: #eae2d6;
  --text-color: #3d5a73;  /* Bleu-gris moyen - Contraste ~5:1 */
  --color-border: #8c1c13;
  --color-primary-rgb: 140, 28, 19;
}

/* Thème Abricot & Marine (accessible, clair) */
html[data-theme="abricot-marine"] {
  --color-primary: #003559;
  --color-secondary: #002a45;
  --color-accent: #cc5a71;
  --bg-color: #ffdfbf;
  --text-color: #4b3a50;  /* Violet-brun - Contraste ~6:1 */
  --color-border: #003559;
  --color-primary-rgb: 0, 53, 89;
}

/* Thème Aigue & Cerise (accessible, clair) */
html[data-theme="aigue-cerise"] {
  --color-primary: #ad2e24;
  --color-secondary: #8e251c;
  --color-accent: #51a3a3;
  --bg-color: #d9f1e3;
  --text-color: #354f3e;  /* Vert-forêt - Contraste ~5:1 */
  --color-border: #ad2e24;
  --color-primary-rgb: 173, 46, 36;
}

/* Thème Terre & Orange (accessible, sombre) */
html[data-theme="terre-orange"] {
  --color-primary: #ff8c42;
  --color-secondary: #e67d39;
  --color-accent: #4fb0c6;
  --bg-color: #453028;
  --text-color: #c4dbd0;  /* Vert d'eau pâle - Contraste ~7:1 */
  --color-border: #ff8c42;
  --color-primary-rgb: 255, 140, 66;
}

/* Thème Marron & Chartreuse (accessible, sombre) */
html[data-theme="marron-chartreuse"] {
  --color-primary: #c5e063;
  --color-secondary: #a2c836;
  --color-accent: #f591a0;
  --bg-color: #583c2e;
  --text-color: #d8ccb8;  /* Beige-doré - Contraste ~7:1 */
  --color-border: #c5e063;
  --color-primary-rgb: 197, 224, 99;
}
</style>

<style>
  .theme-switcher {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    width: 100%;
    max-width: 280px;
    padding: 4px; /* Ajouter un padding pour permettre l'expansion */
    overflow: visible; /* Important: permettre aux éléments de déborder */
  }

  .theme-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    position: relative;
    transition: all 0.2s ease;
    padding: 0;
    overflow: hidden;
    margin: 1px; /* Ajouter une petite marge pour l'espace d'expansion */
  }

  .theme-btn.active {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px var(--color-accent);
    z-index: 10; /* Assurez-vous que le bouton actif apparaît au-dessus des autres */
  }

  .a11y-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 9px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 2px #000;
  }

  .theme-btn .theme-accent {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30%;
    border-radius: 0 0 50% 50%;
  }

</style>

<script>
  // Script côté client pour changer le thème
  document.addEventListener("DOMContentLoaded", () => {
    const themeButtons = document.querySelectorAll(".theme-btn");

    // Ajouter les écouteurs d'événements pour le changement de thème
    themeButtons.forEach((button) => {
      const themeId = button.getAttribute("data-theme");

      if (themeId !== null) {
        button.addEventListener("click", () => {
          // Mettre à jour la classe active
          themeButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");

          // Appliquer le thème
          document.documentElement.setAttribute("data-theme", themeId);
          sessionStorage.setItem("selected-theme", themeId);
        });
      }
    });
  });
</script>
