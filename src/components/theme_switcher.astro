---
// src/components/theme_switcher.astro
// Un composant simple pour basculer entre des thèmes, incluant des options accessibles améliorées

// Définir les thèmes disponibles avec leurs couleurs caractéristiques
const themes = [
  // Thèmes standard clair
  {
    id: "lavande",
    name: "Lavande",
    type: "light",
    bgColor: "#f5f0fa",
    primaryColor: "#7c5295",
    secondaryColor: "#583869",
  },

  // Thèmes standard sombre
  {
    id: "midnight",
    name: "Minuit",
    type: "dark",
    bgColor: "#1f2937",
    primaryColor: "#6889c2",
    secondaryColor: "#415a89",
  },

  // Thèmes accessibles
  {
    id: "vanille-violet",
    name: "Vanille & Violet",
    type: "light",
    bgColor: "#fff8e1",
    primaryColor: "#5b21b6",
    secondaryColor: "#4c1d95",
    isAccessible: true,
  },
  {
    id: "champagne-acier",
    name: "Champagne & Acier",
    type: "light",
    bgColor: "#fdf4ff",
    primaryColor: "#475569",
    secondaryColor: "#334155",
    isAccessible: true,
  },
  {
    id: "amethyste-or",
    name: "Améthyste & Or",
    type: "dark",
    bgColor: "#6b21a8",
    primaryColor: "#facc15",
    secondaryColor: "#eab308",
    isAccessible: true,
  },
  {
    id: "bleu-jaune",
    name: "Bleu & Jaune",
    type: "dark",
    bgColor: "#0e3165",
    primaryColor: "#ffdc00",
    secondaryColor: "#e2c504",
    isAccessible: true,
  },
  {
    id: "gris-ambre",
    name: "Gris & Ambre",
    type: "dark",
    bgColor: "#27272a",
    primaryColor: "#fbbf24",
    secondaryColor: "#d9ab06",
    isAccessible: true,
  },
  {
    id: "ardoise-peche",
    name: "Ardoise & Pêche",
    type: "dark",
    bgColor: "#334155",
    primaryColor: "#fed7aa",
    secondaryColor: "#d78039",
    isAccessible: true,
  },
  {
    id: "prune-menthe",
    name: "Prune & Menthe",
    type: "dark",
    bgColor: "#4a044e",
    primaryColor: "#a7f3d0",
    secondaryColor: "#6ee7b7",
    isAccessible: true,
  },
  {
    id: "aubergine-citron",
    name: "Aubergine & Citron",
    type: "dark",
    bgColor: "#3b0764",
    primaryColor: "#d9f99d",
    secondaryColor: "#a6d455",
    isAccessible: true,
  },
  {
    id: "gris-citron",
    name: "Gris & Citron",
    type: "dark",
    bgColor: "#1f2937",
    primaryColor: "#ecfccb",
    secondaryColor: "#bef264",
    isAccessible: true,
  },
];
---

<div class="theme-switcher">
  {
    themes.map((theme) => (
      <button
        class="theme-btn"
        data-theme={theme.id}
        title={theme.isAccessible ? `${theme.name} (accessible)` : theme.name}
        aria-label={
          theme.isAccessible
            ? `Thème accessible ${theme.name}`
            : `Thème ${theme.name}`
        }
        style={`background-color: ${theme.bgColor}; border-color: ${theme.primaryColor};`}
      >
        <span
          class="theme-accent"
          style={`background-color: ${theme.primaryColor};`}
        />
        {theme.isAccessible && (
          <span class="a11y-indicator select-none">A+</span>
        )}
      </button>
    ))
  }
</div>

<style is:global>
  /* Thème Lavande (clair) */
  html[data-theme="lavande"] {
    --color-primary: #7c5295;
    --color-secondary: #9a6db9;
    --color-accent: #f7ca44;
    --bg-color: #f5f0fa;
    --text-color: #2d2235;
    --color-border: #e5d8f0;
    --color-primary-rgb: 124, 82, 149;
  }

  /* Thème Minuit (sombre) */
  html[data-theme="midnight"] {
    --color-primary: #6889c2;
    --color-secondary: #415a89;
    --color-accent: #f7a046;
    --bg-color: #1f2937;
    --text-color: #e2e8f0;
    --color-border: #374151;
    --color-primary-rgb: 104, 137, 194;
  }
  
  /* Thème Vanille & Violet (accessible, clair) */
  html[data-theme="vanille-violet"] {
    --color-primary: #5b21b6;
    --color-secondary: #4c1d95;
    --color-accent: #f97316;
    --bg-color: #fff8e1;
    --text-color: #1e1b4b;
    --color-border: #5b21b6;
    --color-primary-rgb: 91, 33, 182;
  }
  /* Thème Champagne & Acier (accessible, clair) */
  html[data-theme="champagne-acier"] {
    --color-primary: #475569;
    --color-secondary: #334155;
    --color-accent: #f59e0b;
    --bg-color: #fdf4ff;
    --text-color: #0f172a;
    --color-border: #475569;
    --color-primary-rgb: 71, 85, 105;
  }
  /* Thème Améthyste & Or (accessible, sombre) */
  html[data-theme="amethyste-or"] {
    --color-primary: #facc15;
    --color-secondary: #debd02;
    --color-accent: #a7f3d0;
    --bg-color: #6b21a8;
    --text-color: #f5f3ff;
    --color-border: #facc15;
    --color-primary-rgb: 250, 204, 21;
  }
  /* Thème Bleu & Jaune (accessible, sombre) */
  html[data-theme="bleu-jaune"] {
    --color-primary: #ffdc00;
    --color-secondary: #e2c504;
    --color-accent: #00ff00;
    --bg-color: #0e3165;
    --text-color: #ffffff;
    --color-border: #ffd60a;
    --color-primary-rgb: 255, 220, 0;
  }
  /* Thème Gris & Ambre (accessible, sombre) */
  html[data-theme="gris-ambre"] {
    --color-primary: #fbbf24;
    --color-secondary: #d9ab06;
    --color-accent: #a5f3fc;
    --bg-color: #27272a;
    --text-color: #f8fafc;
    --color-border: #fbbf24;
    --color-primary-rgb: 251, 191, 36;
  }
  /* Thème Ardoise & Pêche (accessible, sombre) */
  html[data-theme="ardoise-peche"] {
    --color-primary: #fed7aa;
    --color-secondary: #e7983d;
    --color-accent: #fdba74;
    --bg-color: #334155;
    --text-color: #f8fafc;
    --color-border: #fed7aa;
    --color-primary-rgb: 254, 215, 170;
  }

  /* Thème Prune & Menthe (accessible, sombre) */
  html[data-theme="prune-menthe"] {
    --color-primary: #9ee6c4;
    --color-secondary: #5ac097;
    --color-accent: #fde047;
    --bg-color: #4a044e;
    --text-color: #fdf2ff;
    --color-border: #a7f3d0;
    --color-primary-rgb: 167, 243, 208;
  }
  /* Thème Aubergine & Citron (accessible, sombre) */
  html[data-theme="aubergine-citron"] {
    --color-primary: #d9f99d;
    --color-secondary: #94c063;
    --color-accent: #fef08a;
    --bg-color: #3b0764;
    --text-color: #f5f5f5;
    --color-border: #d9f99d;
    --color-primary-rgb: 217, 249, 157;
  }
  /* Thème Gris & Citron (accessible, sombre) */
  html[data-theme="gris-citron"] {
    --color-primary: #ecfccb;
    --color-secondary: #8cb447;
    --color-accent: #96c348;
    --bg-color: #1f2937;
    --text-color: #f9fafb;
    --color-border: #ecfccb;
    --color-primary-rgb: 236, 252, 203;
  }
</style>

<style>
  .theme-switcher {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    width: 100%;
    max-width: 280px;
    padding: 4px; /* Ajouter un padding pour permettre l'expansion */
    overflow: visible; /* Important: permettre aux éléments de déborder */
  }

  .theme-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    position: relative;
    transition: all 0.2s ease;
    padding: 0;
    overflow: hidden;
    margin: 1px; /* Ajouter une petite marge pour l'espace d'expansion */
  }

  .theme-btn.active {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px var(--color-accent);
    z-index: 10; /* Assurez-vous que le bouton actif apparaît au-dessus des autres */
  }

  .a11y-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 9px;
    font-weight: bold;
    color: #fff;
    text-shadow: 0 0 2px #000;
  }

  .theme-btn .theme-accent {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30%;
    border-radius: 0 0 50% 50%;
  }
</style>

<script>
  // Script côté client pour changer le thème
  document.addEventListener("DOMContentLoaded", () => {
    const themeButtons = document.querySelectorAll(".theme-btn");

    // Ajouter les écouteurs d'événements pour le changement de thème
    themeButtons.forEach((button) => {
      const themeId = button.getAttribute("data-theme");

      if (themeId !== null) {
        button.addEventListener("click", () => {
          // Mettre à jour la classe active
          themeButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");

          // Appliquer le thème
          document.documentElement.setAttribute("data-theme", themeId);
          sessionStorage.setItem("selected-theme", themeId);
        });
      }
    });
  });
</script>