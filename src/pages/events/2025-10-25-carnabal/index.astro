---
// src/pages/events/2025-10-25-carnabal/index.astro
// Page de l'événement CarnaBal optimisée avec Tailwind

import Layout from "../../../layouts/layout.astro";
import PdfViewer from "../../../components/pdf_viewer.astro";
import OptimizeImage from "../../../components/optimize_image.astro";
import EventNavigation from "../../../components/event_nav.astro";
import Gallery from "../../../components/gallery.astro";
import { getCollection } from "astro:content";
import type { EventEntry } from "../../../../types";
import Ghost from "../../../components/ghost.astro";
import Bule from "../../../components/bule.astro";
import Loup from "../../../components/loup.astro";

// Récupérer tous les événements
const eventsEntries = (await getCollection("events")) as EventEntry[];

// Récupérer l'événement CarnaBal
const carnaBal = eventsEntries.find(
  (entry: EventEntry) => entry.slug === "2025-10-25-carnabal"
);

if (!carnaBal) {
  return Astro.redirect("/events/");
}

// Trouver la prochaine cantine
const currentDate = new Date();
const nextCantine = eventsEntries
  .filter((event: EventEntry) => {
    const eventDate =
      event.data.date instanceof Date
        ? event.data.date
        : new Date(event.data.date);

    return (
      eventDate > currentDate &&
      event.data.draft !== true &&
      event.data.title.toLowerCase().includes("cantine")
    );
  })
  .sort((a: EventEntry, b: EventEntry) => {
    const dateA =
      a.data.date instanceof Date ? a.data.date : new Date(a.data.date);
    const dateB =
      b.data.date instanceof Date ? b.data.date : new Date(b.data.date);
    return dateA.getTime() - dateB.getTime();
  })[0];

// Fallback : la cantine la plus récente si aucune prochaine
const mostRecentCantine = !nextCantine
  ? eventsEntries
      .filter((event: EventEntry) => {
        const eventDate =
          event.data.date instanceof Date
            ? event.data.date
            : new Date(event.data.date);

        return (
          eventDate <= currentDate &&
          event.data.draft !== true &&
          event.data.title.toLowerCase().includes("cantine")
        );
      })
      .sort((a: EventEntry, b: EventEntry) => {
        const dateA =
          a.data.date instanceof Date ? a.data.date : new Date(a.data.date);
        const dateB =
          b.data.date instanceof Date ? b.data.date : new Date(b.data.date);
        return dateB.getTime() - dateA.getTime();
      })[0]
  : null;

// Récupérer le contenu
const contentRender = await carnaBal.render();
const { Content } = contentRender;

// Chemins des silhouettes avec métadonnées
const silhouettes = [
  {
    src: "/src/assets/silhouettes/silhouette1.png",
    alt: "Silhouette monstrueuse 1",
    title: "Silhouette 1",
  },
  {
    src: "/src/assets/silhouettes/silhouette2.png",
    alt: "Silhouette monstrueuse 2",
    title: "Silhouette 2",
  },
  {
    src: "/src/assets/silhouettes/silhouette3.png",
    alt: "Silhouette monstrueuse 3",
    title: "Silhouette 3",
  },
];

// Paramètres PDF
const pdfPath = "/pdf/carnabal-des-monstres.pdf";
const previewPages = [
  "/pdf/preview/carnabal-page1.jpg",
  "/pdf/preview/carnabal-page2.jpg",
  "/pdf/preview/carnabal-page3.jpg",
  "/pdf/preview/carnabal-page4.jpg",
];
---

<Layout
  title="CarnaBal des monstres - 25 octobre 2025 - Briec2000"
  description="CarnaBal des monstres le 25 octobre 2025 à Briec : parade festive à 17h puis grande fête avec concerts à l'Arthémuse jusqu'à 1h. Événement ouvert à tous par Briec2000."
>
  <article class="max-w-4xl">
    <!-- Section d'introduction avec silhouettes -->
    <div
      class="relative overflow-hidden p-6 rounded-lg bg-[color:rgba(var(--color-primary-rgb),0.08)] min-h-96 flex items-center z-10 md:min-h-[500px]"
    >
      <!-- Silhouettes en arrière-plan -->
      <div
        class="absolute inset-0 w-full overflow-hidden z-0 pointer-events-none opacity-60"
      >
        <OptimizeImage
          src={silhouettes[0].src}
          alt={silhouettes[0].alt}
          class="absolute -right-32 -top-24 w-72 h-auto rotate-[5deg] md:-right-24 md:w-96"
          widths={[300, 400]}
          sizes="300px"
          loading="eager"
        />
        <OptimizeImage
          src={silhouettes[1].src}
          alt={silhouettes[1].alt}
          class="absolute right-12 -bottom-36 w-60 h-auto rotate-[6deg] md:right-24 md:w-80"
          widths={[250, 350]}
          sizes="250px"
          loading="lazy"
        />
        <OptimizeImage
          src={silhouettes[2].src}
          alt={silhouettes[2].alt}
          class="absolute right-48 top-12 w-48 h-auto scale-x-[-1] rotate-[-2deg] md:right-72 md:w-72"
          widths={[200, 300]}
          sizes="200px"
          loading="lazy"
        />
      </div>

      <!-- Contenu principal -->
      <div class="relative z-20 max-w-full sm:max-w-[80%]">
        <div
          class="inline-block bg-[color:var(--color-secondary)] text-white px-3 py-1 rounded-full text-sm font-medium mb-4"
        >
          Samedi 25 Octobre 2025
        </div>
        <h1
          class="text-3xl md:text-4xl leading-tight mb-4 text-[color:var(--color-primary)]"
        >
          CarnaBal des monstres
        </h1>
        <p class="text-lg mb-6 italic max-w-xl leading-relaxed">
          Entre dans la saison sombre en faisant la fête sous des costumes
          sauvages !
        </p>

        <!-- Métadonnées de l'événement -->
        <div class="flex flex-col gap-2 mb-8 text-sm">
          <div>
            <strong>📍 Lieux :</strong> Centre social SIVOM + Place de Ruthin + Salle
            Arthémuse
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex flex-wrap gap-4">
          <!-- <a href="#programme" class="btn inline-flex items-center gap-2">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
            Voir le programme
          </a>-->
          <a
            href={pdfPath}
            download="CarnaBal_des_monstres_2025.pdf"
            class="btn inline-flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"
              ></path>
            </svg>
            Télécharger le flyer
          </a>
        </div>
      </div>
    </div>
    <!-- Image du CarnaBal -->
    <div class="my-10 text-center">
      <OptimizeImage
        src="/src/assets/events/carnabal.jpg"
        alt="CarnaBal des monstres et créatures 2025"
        class="w-full max-w-2xl mx-auto rounded-lg shadow-lg"
        widths={[400, 800, 1200]}
        sizes="(max-width: 767px) 100vw, 800px"
        transition:name={`event-image-2025-10-25-carnabal`}
      />
    </div>
    <!-- Histoire et origine -->
    <section
      class="card bg-[color:rgba(var(--color-primary-rgb),0.03)] p-8 my-10 rounded-xl border-t-4 border-t-[color:var(--color-primary)] shadow-lg"
    >
      <h2 class="text-2xl mb-6 text-center border-b pb-2">
        L'esprit du CarnaBal
      </h2>

      <div class="space-y-4 leading-relaxed">
        <p>
          Alors que dans la fraicheur de l'hiver la nature hiberne encore, c'est
          autour d'un feu au solstice qu'un groupe de personnes commence à
          imaginer accueillir ensemble, et avec d'autres, la saison froide
          l'année suivante.
        </p>

        <p>
          À la levée des dormances, cette discussion prend corps, et se mue en
          une association : <strong class="whitespace-nowrap">Briec 2000</strong
          >. Son idée ? Rassembler les énergies créatives et joyeuses, et
          provoquer la rencontre entre les gens.
        </p>

        <p>
          Et pour cela, ce premier projet : l'organisation d'un <strong
            >CarnaBal de monstres et de créatures</strong
          >, pour célébrer ensemble l'entrée dans la « saison sombre » à
          l'automne 2025.
        </p>

        <p>
          Inspiré·e·s par les anciennes fêtes et les carnavals sauvages, ce
          CarnaBal propose à tous·tes celles et ceux qui le souhaitent de se
          bricoler un habit, de faire disparaître leurs formes d'humain·e·s sous
          les tissus, les fougères, les objets récupérés, et de retrouver leurs
          congénères monstrueux·es dans les rues du bourg, dans une procession
          joyeuse jusqu'à l'Arthémuse, où se poursuivront les festivités.
        </p>
      </div>
    </section>
    <!-- Présentation des artistes -->
    <section id="artistes" class="my-10">
      <h2 class="text-2xl mb-6 border-b pb-2">Les artistes du CarnaBal</h2>

      <div class="space-y-6">
        <!-- Adrien Contoux -->
        <div class="flex-1">
          <h3 class="text-lg font-medium mb-2">
            Adrien Choque & Alitché - Contes monstrueux
          </h3>
          <p class="text-sm opacity-75 mb-1">📅 15h au Centre social SIVOM</p>
          <p class="text-sm leading-relaxed mb-3">
            Adrien et Alitché ont échafaudé un plan d'histoires de monstres à
            vous porter à vos oreilles.
          </p>
          <p class="text-sm leading-relaxed">
            Tout public et gratuit. Dans la salle
            forum du centre social du pays Glazik.
          </p>
        </div>
        <!-- Casiomaha -->
        <div class="flex-1">
          <h3 class="text-lg font-medium mb-2">Casiomaha</h3>
          <p class="text-sm opacity-75 mb-2">Duo pop-punk synthétique tribal</p>
          <p class="text-sm leading-relaxed mb-3">
            Mahawatchi & Casiowatcha se connaissent depuis longtemps. Ils
            composent à partir de vieux synthés cheap des années 80.
          </p>
          <p class="text-sm leading-relaxed">
            Sur scène, les musiciens arborent d'impressionnants masques de
            l’artiste-plasticienne Odette Picaud, apportant à leur musique
            pop-punk synthétique, une ambiance tribale, envoûtante et
            énigmatique, pleine d'énergie positive et rebelle.
          </p>
        </div>

        <!-- Iono Lutrev -->
        <div class="flex-1">
          <h3 class="text-lg font-medium mb-2">Iono Lutrev</h3>
          <p class="text-sm opacity-75 mb-2">
            Power-duo électro-rock MÉGALOSCHLAG®
          </p>
          <p class="text-sm leading-relaxed mb-3">
            Solenne Garnier, soutenue par le groove de Capitaine Couette à la batterie, 
            joue à la fois du synthétiseur et de la trompette.
          </p>
          <p class="text-sm leading-relaxed">
            Grande prêtresse du MEGALO-SCHLAG, c'est-à-dire l'équilibre parfait
            entre virtuosité technique et rien-à-foutrisme. Une électro-pop
            garage qui groove !
          </p>
        </div>

        <!-- Kick & Flûte -->
        <div class="flex-1">
          <h3 class="text-lg font-medium mb-2">Kick & Flûte</h3>
          <p class="text-sm opacity-75 mb-2">Duo électro-techno & clarinette</p>
          <p class="text-sm leading-relaxed mb-3">
            Gabriel Siancas et Sébastien Turner proposent une formation entre
            machines électroniques, clarinette et voix, qui mélange les musiques
            du monde et la techno. Dance floor music, électro-techno du futur et
            clarinette virevoltante !
          </p>
          <p class="text-sm leading-relaxed">
            Un duo d'une musique brute et dansante, sensible, exigeante et
            hybride. Les genres musicaux s'y mêlent sans distinctions d'espèces
            : musiques populaires ou savantes, traditionnelles ou électroniques,
            tout est permis.
          </p>
        </div>
      </div>

      <div class="mt-6 text-center">
        <p class="text-sm italic opacity-70">
          Tous ces artistes se produiront lors de la soirée à l'Arthémuse à
          partir de 19h !
        </p>
      </div>
    </section>
    <!-- Galerie de silhouettes monstrueuses -->
    <!-- Galerie de silhouettes pour mobile sans popup -->
    <div class="mb-10 sm:hidden">
      <h2 class="text-xl mb-4">Inspirations monstrueuses</h2>
      <div class="flex justify-center">
        <div class="flex gap-2 overflow-x-auto pb-4 snap-x snap-mandatory">
          {
            silhouettes.map((silhouette, index) => (
              <div class="flex-none w-40 snap-center">
                <div class="bg-[color:rgba(var(--color-primary-rgb),0.05)] rounded-lg shadow-md overflow-hidden">
                  <OptimizeImage
                    src={silhouette.src}
                    alt={silhouette.alt}
                    class="w-full h-80 object-cover object-top theme-filtered"
                    widths={[160, 320]}
                    sizes="160px"
                    loading="lazy"
                  />
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </div>

    <!-- Composant PdfViewer -->
    <PdfViewer
      pdfPath={pdfPath}
      previewPages={previewPages}
      downloadFileName="CarnaBal_des_monstres_2025.pdf"
      title="Flyer du CarnaBal"
      description="Téléchargez le flyer pour découvrir tous les détails du CarnaBal des monstres et créatures 2025."
    />

    <!-- Ateliers préparatoires -->
    <section id="ateliers" class="my-8">
      <!-- 🎭 Déguisez-vous ! -->
      <div
        class="mb-6 p-4 bg-[color:rgba(var(--color-secondary-rgb,131,197,190),0.1)] rounded-lg border-l-4 border-l-[color:var(--color-secondary)]"
      >
        <p class="font-medium mb-2">🎭 Déguisez-vous !</p>
        <p class="text-sm">
          L'esprit du CarnaBal, c'est de venir déguisé·e en monstre ou créature
          ! Laissez libre cours à votre créativité ou participez à nos ateliers
          de préparation.
        </p>
      </div>

      <div class="grid gap-4 md:grid-cols-2 mb-8">
        <div
          class="card p-6 bg-[color:rgba(var(--color-primary-rgb),0.03)] hover:bg-[color:rgba(var(--color-primary-rgb),0.05)] transition-colors"
        >
          <h3 class="text-lg mb-3 flex items-center gap-2">
            <svg
              class="w-5 h-5 text-[color:var(--color-primary)]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <circle cx="6" cy="6" r="3"></circle>
              <path d="M8.12 8.12 12 12M20 4 8.12 15.88"></path>
              <circle cx="6" cy="18" r="3"></circle>
              <path d="M14.8 14.8 20 20"></path>
            </svg>
            Atelier costume avant soirée crêpe
          </h3>
          <p class="mb-3 font-medium">13 septembre au SIVOM</p>
          <p class="text-sm mb-4 opacity-80">
            Création de costumes avec matériaux à partir de 16h. <br />Tout
            public.
          </p>
          <a href="/events/2025-09-13-monstres-et-bilig/" class="btn text-sm"
            >Voir les détails</a
          >
        </div>
      </div>

      <div class="text-center">
        <p class="text-sm italic opacity-70">
          Ces ateliers vous permettront d'arriver le 25 octobre avec un costume
          unique ! Mais vous pouvez aussi venir avec votre propre création.
        </p>
      </div>
    </section>
    <!-- Galerie de silhouettes pour desktop avec popup -->
    <Gallery
      items={silhouettes}
      title="Inspirations monstrueuses"
      description="Cliquez sur une silhouette pour l'agrandir"
      className="my-10 hidden sm:block"
    />

    <!-- Navigation entre événements -->
    <EventNavigation currentSlug={carnaBal.slug} />
  </article>

  <Ghost
    className="hidden md:block rotate-y-180"
    style="top: 15%; right: 12%;"
  />
  <Bule
    className="hidden md:block rotate-y-180"
    style="top: 300px; right: 280px;"
  />
  <Loup
    className="hidden md:block rotate-y-180"
    style="top: 335px; right: 173px;"
  />
</Layout>